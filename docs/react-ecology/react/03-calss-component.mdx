import { Badge, Tab, Tabs } from '@theme';

# ç±»ç»„ä»¶

å¼ºçƒˆå»ºè®®ä½¿ç”¨**å‡½æ•°å¼ç»„ä»¶**ï¼Œè€Œä¸æ˜¯ç±»ç»„ä»¶ã€‚

:::danger ä¸ºäº†é¿å…æœ¯è¯­å‡ºç°æ··æ·†ï¼Œä¸‹é¢å¯¹æ–‡æ¡£ä¸­æåŠçš„æœ¯è¯­è¿›è¡Œè§„èŒƒè§£é‡Šï¼š

- æ¸²æŸ“ï¼šå¯ä»¥ç®€å•çš„ç†è§£ä¸ºæ˜¯ render æ–¹æ³•çš„æ‰§è¡Œï¼Œç”¨äºç”Ÿæˆè™šæ‹Ÿ DOM
- ç»˜åˆ¶ï¼šæµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•ï¼Œå°½ç®¡è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œæµè§ˆå™¨æ¸²æŸ“â€ï¼Œä½†ä¸ºäº†é¿å…æ··æ·†ï¼Œè¿˜æ˜¯å°†å…¶ç§°ä¸ºâ€œç»˜åˆ¶â€

:::

## å®šä¹‰ä¸€ä¸ªç»„ä»¶

`Component` æ˜¯ React ç»„ä»¶çš„åŸºç±»ï¼Œå¦‚æœè¦ä½¿ç”¨ç±»ç»„ä»¶ï¼Œéœ€è¦ç»§æ‰¿å†…ç½®çš„ `Component` ç±»å¹¶å®šä¹‰ `render`
æ–¹æ³•ã€‚è™½ç„¶ç±»ç»„ä»¶ä»ç„¶è¢« React æ”¯æŒï¼Œä½†ä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ã€‚

```jsx {2}
class Greeting extends Component {
  // åªæœ‰ render æ–¹æ³•æ˜¯å¿…è¦çš„ï¼Œå…¶ä»–å±æ€§éƒ½æ˜¯å¯é€‰çš„ã€‚
  render() {
    return <h1>Hello, {this.props.name}!</h1>;
  }
}

export default Greeting;
```

æ¯å½“ç»„ä»¶ï¼ˆæˆ–å…¶ç¥–å…ˆä¹‹ä¸€ï¼‰çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œ[`render`](https://zh-hans.react.dev/reference/react/Component#render)
æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ`render`
æ–¹æ³•åº”è¯¥æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€æ®µ JSXã€‚å®ƒä¹Ÿä¸åº”è¯¥åŒ…å«å‰¯ä½œç”¨ï¼ˆå¦‚è®¢é˜…ç›‘å¬äº‹ä»¶ï¼‰æˆ–ä¸æµè§ˆå™¨äº¤äº’è¡Œä¸ºã€‚å‰¯ä½œç”¨åº”è¯¥å‘ç”Ÿåœ¨äº‹ä»¶å¤„ç†ç¨‹åºæˆ–ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¸­ã€‚

### å“åº”å¼çŠ¶æ€

å“åº”æ€§æ˜¯ä¸€ç§å¯ä»¥ä½¿æˆ‘ä»¬å£°æ˜å¼å¤„ç†å˜åŒ–çš„ç¼–ç¨‹èŒƒå¼ï¼Œå“åº”å¼çŠ¶æ€èƒ½å¤Ÿåœ¨æ•°æ®å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ä¾èµ–è¯¥æ•°æ®çš„ UI æˆ–é€»è¾‘æ›´æ–°ï¼Œè€Œæ— éœ€æ‰‹åŠ¨æ“ä½œ DOM æˆ–é¢å¤–è§¦å‘äº‹ä»¶ã€‚

åœ¨ç±»ç»„ä»¶ä¸­ï¼Œå®ä¾‹çš„ [`state`](https://zh-hans.react.dev/learn/state-a-components-memory)
å±æ€§å£°æ˜çš„æ•°æ®ä¸ºå“åº”å¼æ•°æ®ï¼Œè¦æ›´æ–° state çš„è¯ï¼Œå¿…é¡»è°ƒç”¨
[`this.setState`](https://zh-hans.react.dev/reference/react/Component#setstate)ã€‚

```jsx {9-11}
import { Component } from 'react';

export default class Counter extends Component {
  state = {
    name: 'Taylor',
  };

  handleNameChange = (e) => {
    this.setState({
      name: e.target.value,
    });
  };

  render() {
    return (
      <>
        <input value={this.state.name} onChange={this.handleNameChange} />
        <p>Hello, {this.state.name}.</p>
      </>
    );
  }
}
```

`setState` æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå®ƒä¼šå°†ç»„ä»¶çš„ state æ›´æ”¹åŠ å…¥é˜Ÿåˆ—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ `setState` æ—¶ **ä¸ä¼š**
æ›´æ”¹å·²æ‰§è¡Œä»£ç ä¸­å½“å‰çš„ state, å®ƒåªä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œå¹¶ä¸”åªå½±å“ **ä¸‹ä¸€ä¸ª** æ¸²æŸ“å¼€å§‹è¿”å›çš„ `this.state`ã€‚

```jsx {2,6}
function handleClick() {
  console.log(this.state.name); // "Taylor"
  this.setState({
    name: 'Robin',
  });
  console.log(this.state.name); // ä¾ç„¶æ˜¯ "Taylor"!
}
```

æ¢å¥è¯è¯´ï¼Œ**state å¦‚åŒä¸€å¼ å¿«ç…§ï¼Œå®ƒçš„å€¼æ°¸è¿œä¸ä¼šåœ¨ä¸€æ¬¡æ¸²æŸ“çš„å†…éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œå³ä½¿è·å– state çš„è¡Œä¸ºæ˜¯å¼‚æ­¥çš„**ã€‚

```jsx preview
import { Component } from 'react';

export default class Counter extends Component {
  state = {
    number: 0,
  };

  handleClick = () => {
    this.setState({ number: this.state.number + 6 });
    setTimeout(() => {
      alert(this.state.number);
    }, 2000);
  };

  render() {
    return (
      <>
        <h1>{this.state.number}</h1>
        <button onClick={this.handleClick}>+6</button>
      </>
    );
  }
}
```

`setState` ç¬¬ä¸€ä¸ªå‚æ•°è·å–çš„ `nextState` ä¼š**æµ…å±‚åˆå¹¶**åˆ° `this.state` ä¸­ï¼Œå¹¶ **ä¸æ˜¯** ç›´æ¥è¦†ç›–ã€‚å®ƒè¿˜å¯ä»¥æ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°
`callback`ï¼Œè¡¨ç¤ºæäº¤æ›´æ–°åçš„å›è°ƒï¼Œå®ƒçš„æ‰§è¡Œæ—¶æœºåœ¨ `componentDidUpdate` ä¹‹åã€‚

```jsx {9-11,16-18}
import { Component } from 'react';

export default class Counter extends Component {
  state = {
    number: 0,
    text: 'æœå†»æ€ª',
  };

  componentDidUpdate() {
    console.log('step2: è§¦å‘ componentDidUpdate');
  }

  handleClick = () => {
    this.setState(
      { number: this.state.number + 6 }, // æ¸å±‚åˆå¹¶ï¼Œä¸ä¼šå½±å“ text å±æ€§
      () => {
        console.log('step3: è§¦å‘ setState å›è°ƒ');
      },
    );
  };

  render() {
    console.log('step1: è§¦å‘ render');

    return (
      <>
        <h1>
          {this.state.text} - {this.state.number}
        </h1>
        <button onClick={this.handleClick}>+6</button>
      </>
    );
  }
}
```

### è‡ªåŠ¨æ‰¹å¤„ç†

è‡ªåŠ¨æ‰¹å¤„ç†æ˜¯æŒ‡ React ä¼šæŠŠ state çš„æ›´æ–°åŠ å…¥é˜Ÿåˆ—ï¼Œå½“å‰**å¾®ä»»åŠ¡ç»“æŸå**ç»Ÿä¸€è®¡ç®—ä¸‹ä¸€æ¬¡æ¸²æŸ“ state çš„å€¼ï¼Œå¤šä¸ªçŠ¶æ€æ›´æ–°åˆå¹¶æˆä¸€æ¬¡é‡æ–°æ¸²æŸ“çš„è¿‡ç¨‹ã€‚

:::warning æ³¨æ„

React18 ä¹‹å‰ï¼ŒReact åªåœ¨æµè§ˆå™¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è¿›è¡Œè‡ªåŠ¨æ‰¹å¤„ç†è¡Œä¸ºï¼Œè€Œåœ¨ Promiseã€setTimeout å’ŒåŸç”Ÿäº‹ä»¶å¤„ç†å‡½æ•°æˆ–å…¶ä»–äº‹ä»¶ä¸­ä¸ä¼šè¿›è¡Œè‡ªåŠ¨æ‰¹å¤„ç†ã€‚

:::

```jsx preview
import { Component } from 'react';

export default class Counter extends Component {
  state = {
    count: 0,
  };
  handleClick = () => {
    this.setState({ count: this.state.count + 1 });
    this.setState({ count: this.state.count + 1 });
    this.setState({ count: this.state.count + 1 });
  };
  render() {
    return (
      <>
        <h1>{this.state.count}</h1>
        <button onClick={this.handleClick}>+3</button>
      </>
    );
  }
}
```

ä¸Šé¢çš„ä¾‹å­åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä»£ç æ‰§è¡Œç»“æŸåï¼Œä¼šå¯¹çŠ¶æ€è¿ç»­è®¡ç®—ä¸‰æ¬¡ï¼Œæœ€åç¡®å®šä¸‹ä¸€æ¬¡æ¸²æŸ“çš„ state çš„å€¼ã€‚

ç”±äº state åœ¨å½“å‰æ¸²æŸ“æœŸé—´çš„å€¼æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æ— è®ºæ‰§è¡Œå¤šå°‘é `this.setState({ count: 0 + 1 })`ï¼Œstate çš„å€¼æ€»æ˜¯
`0`ï¼Œä¸‹ä¸€æ¬¡æ¸²æŸ“çš„ state çš„å€¼ç”±æœ€åä¸€æ¬¡ `setState` å¾—å‡ºï¼Œä¹Ÿå°±æ˜¯ `1` äº†ã€‚

```jsx
this.setState({ count: 0 + 1 });
this.setState({ count: 0 + 1 });
this.setState({ count: 0 + 1 });
```

å¦‚æœéœ€è¦æ ¹æ®å‰ä¸€ä¸ª state æ¥è®¾ç½® stateï¼Œåº”è¯¥ä½¿ç”¨çŠ¶æ€**æ›´æ–°å‡½æ•°**ã€‚å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä¸Šä¸€ä¸ª state å’Œ props ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”åº”è¯¥è¿”å›è¦æµ…å±‚åˆå¹¶åˆ°
`this.state` ä¸­çš„å¯¹è±¡ã€‚

```jsx preview
import { Component } from 'react';

export default class Counter extends Component {
  state = {
    count: 0,
  };
  handleClick = () => {
    this.setState((prevState) => ({ count: prevState.count + 1 }));
    this.setState((prevState) => ({ count: prevState.count + 1 }));
    this.setState((prevState) => ({ count: prevState.count + 1 }));
  };
  render() {
    return (
      <>
        <h1>{this.state.count}</h1>
        <button onClick={this.handleClick}>+3</button>
      </>
    );
  }
}
```

### flushSync åŒæ­¥åˆ·æ–°DOM <Badge text="React18+" type="warning"></Badge>

[`flushSync`](https://zh-hans.react.dev/reference/react-dom/flushSync) æ˜¯ React
DOM æä¾›çš„ä¸€ä¸ª APIï¼Œå®ƒå…è®¸ä½ å¼ºåˆ¶åŒæ­¥åˆ·æ–°æŸäº›çŠ¶æ€çš„æ›´æ–°ï¼Œè€Œä¸æ˜¯å°†çŠ¶æ€æ›´æ–°è¡Œä¸ºå‹å…¥è‡ªåŠ¨æ‰¹å¤„ç†é˜Ÿåˆ—ã€‚

```jsx {16-26}
import { Component } from 'react';
import { flushSync } from 'react-dom';

export default class Demo extends Component {
  state = {
    count: 0,
  };

  handleClick = () => {
    // å¼‚æ­¥æ›´æ–°
    this.setState((preState) => {
      console.log('æ›´æ–°1æ‰§è¡Œ');
      return { count: preState.count + 1 };
    });

    flushSync(() => {
      this.setState((preState) => {
        console.log('æ›´æ–°2æ‰§è¡Œ');
        return { count: preState.count + 1 };
      });
      this.setState((preState) => {
        console.log('æ›´æ–°3æ‰§è¡Œ');
        return { count: preState.count + 1 };
      });
    });

    // å¼‚æ­¥æ›´æ–°
    this.setState((preState) => {
      console.log('æ›´æ–°4æ‰§è¡Œ');
      return { count: preState.count + 1 };
    });
  };

  render() {
    console.log(`è§¦å‘æ¸²æŸ“, å½“å‰count: ${this.state.count}`);
    return (
      <>
        <h1>{this.state.count}</h1>
        <button onClick={this.handleClick}>ç‚¹å‡»æˆ‘</button>
      </>
    );
  }
}
```

:::info `flushSync` çš„æ ¸å¿ƒè¡Œä¸ºæœ‰ï¼š

- åœ¨ `flushSync` å›è°ƒä¸­ï¼ŒçŠ¶æ€çš„æ›´æ–°ä»ç„¶å…·æœ‰æ‰¹å¤„ç†è¡Œä¸ºï¼Œå¦‚æœä¸å¸Œæœ›å¦‚æ­¤ï¼Œéœ€è¦ä½¿ç”¨å¤šä¸ª `flushSync` åŒ…è£¹
- `flushSync` ä¼šæå‰æ‰§è¡Œä¹‹å‰ç§¯å‹çš„æ‰€æœ‰æ›´æ–°ï¼Œè€Œä¸ä»…ä»…æ˜¯å®ƒè‡ªèº«å›è°ƒå†…çš„æ›´æ–°
- å¤šä¸ª `flushSync` ä¼šè§¦å‘å¤šæ¬¡æ¸²æŸ“
- `flushSync` ä¸å½±å“åç»­ä»£ç çš„æµç¨‹ï¼Œä½†åç»­ä»£ç çš„ state å·²ç»å˜æ›´

:::

```js
// æ›´æ–°1æ‰§è¡Œ
// æ›´æ–°2æ‰§è¡Œ
// æ›´æ–°3æ‰§è¡Œ
// è§¦å‘æ¸²æŸ“ï¼Œå½“å‰count: 3
// æ›´æ–°4æ‰§è¡Œ
// è§¦å‘æ¸²æŸ“ï¼Œå½“å‰count: 4
```

`flushSync` ä¼šç ´å React çš„ä¼˜åŒ–ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œåº”å°½å¯èƒ½é¿å…ä½¿ç”¨å®ƒã€‚

## ä¼ é€’ props

React ç»„ä»¶ä½¿ç”¨ [props](https://zh-hans.react.dev/reference/react/Component#props)
æ¥äº’ç›¸é€šä¿¡ï¼Œæ¯ä¸ªçˆ¶ç»„ä»¶éƒ½å¯ä»¥æä¾› props ç»™å®ƒçš„å­ç»„ä»¶ã€‚prop çš„å€¼å¯ä»¥ä¸ºä»»æ„ç±»å‹ï¼ŒåŒ…æ‹¬å¯¹è±¡ã€æ•°ç»„å’Œå‡½æ•°ã€‚

<Tabs>
  <Tab label="çˆ¶ç»„ä»¶">

```jsx {2,9}
import { Component } from 'react';
import MyButton from './MyButton.jsx';

class Profile extends Component {
  state = {
    msg: 'hello',
  };
  render() {
    return <MyButton msg={this.state.msg}></MyButton>;
  }
}
```

  </Tab>
  <Tab label="å­ç»„ä»¶">

```jsx {5}
import { Component } from 'react';

class MyButton extends Component {
  render() {
    return <button msg={this.props.msg}></button>;
  }
}
```

  </Tab>
</Tabs>

å­ç»„ä»¶ä½¿ç”¨ `this.props` æ¥è·å–çˆ¶ç»„ä»¶ä¼ å…¥çš„ propsã€‚

### children prop

`children` æ˜¯ React ç»„ä»¶ä¸­æœ€ç‰¹æ®Šä¹Ÿæ˜¯æœ€å¼ºå¤§çš„ props ä¹‹ä¸€ï¼Œå®ƒå…è®¸ç»„ä»¶æ¥æ”¶å¹¶æ¸²æŸ“å…¶å­å…ƒç´ ã€‚`children`
è¡¨ç¤ºç»„ä»¶æ ‡ç­¾çš„æ‰€æœ‰å†…å®¹ï¼Œæœ‰ç‚¹ç±»ä¼¼ä¸ Vue ä¸­çš„é»˜è®¤æ’æ§½ï¼š

<Tabs>
  <Tab label="çˆ¶ç»„ä»¶">

```jsx {2,9}
import { Component } from 'react';
import MyButton from './MyButton.jsx';

class Profile extends Component {
  handleSmash = () => {
    alert('æ­£åœ¨æ’­æ”¾ï¼');
  };
  render() {
    return <MyButton onSmash={this.handleSmash}>æ’­æ”¾ç”µå½±</MyButton>;
  }
}
```

  </Tab>
  <Tab label="å­ç»„ä»¶">

```jsx {5}
import { Component } from 'react';

class MyButton extends Component {
  render() {
    return <button onClick={this.props.onSmash}>{this.props.children}</button>;
  }
}
```

  </Tab>
</Tabs>

:::info æ³¨æ„

å¦‚æœæƒ³å®ç°ç±»ä¼¼ Vue ä¸­å…·åæ’æ§½çš„æ•ˆæœï¼Œå¯ä»¥ç›´æ¥å°† JSX å½“ä½œæ™®é€šçš„ props è¿›è¡Œä¼ é€’ã€‚

:::

### é»˜è®¤å€¼

[`static defaultProps`](https://zh-hans.react.dev/reference/react/Component#static-defaultprops)
å¯ä»¥ç”¨æ¥è®¾ç½®é»˜è®¤çš„ props å±æ€§å€¼ã€‚å®ƒä»¬å°†åœ¨ props ä¸º `undefined` æˆ–è€…ç¼ºå°‘æ—¶æœ‰æ•ˆï¼Œä½†**åœ¨ props ä¸º `null` æ—¶æ— æ•ˆ**ã€‚

```jsx {3-5}
import { Component } from 'react';

class Button extends Component {
  static defaultProps = {
    color: 'blue',
  };

  render() {
    return <button className={this.props.color}>click me</button>;
  }
}
```

### çº¦æŸç±»å‹

å¦‚æœéœ€è¦çº¦æŸ props å±æ€§å€¼çš„ç±»å‹éœ€è¦å®‰è£… [prop-types](https://github.com/facebook/prop-types) åº“ï¼Œæ¥ç€å°±å¯ä»¥ä½¿ç”¨
`static propTypes` é™æ€å±æ€§å®šä¹‰ props çš„ç±»å‹ã€‚

```jsx {2,5-7}
import { Component } from 'react';
import PropTypes from 'prop-types';

class Button extends Component {
  static propTypes = {
    color: PropTypes.string.isRequired,
  };

  render() {
    return <button className={this.props.color}>click me</button>;
  }
}
```

:::info æ³¨æ„

prop-types çš„ç±»å‹æ£€æµ‹å‘ç”Ÿåœ¨è¿è¡Œæ—¶ï¼Œå¯¹äº JavaScript +
React å¯è¿˜è¡Œã€‚ä½†å¦‚æœé‡‡ç”¨çš„æ˜¯ TypeScriptï¼Œä¾èµ– TypeScript çš„ç±»å‹æ£€æµ‹åœ¨ç¼–è¯‘é˜¶æ®µå‘ç°é”™è¯¯æ›´åŠ åˆé€‚ã€‚

:::

### constructor

ä¸€èˆ¬æ¥è¯´ï¼Œ[`constructor`](https://zh-hans.react.dev/reference/react/Component#constructor)
ä»…ç”¨äºä¸¤ä¸ªç›®çš„ã€‚å®ƒå¯ä»¥å£°æ˜ state ä»¥åŠå°†ç±»æ–¹æ³• ç»‘å®š åˆ°ç±»å®ä¾‹ä¸Šã€‚

```jsx {2-6}
class Counter extends Component {
  constructor(props) {
    super(props);
    this.state = { counter: 0 };
    this.handleClick = this.handleClick.bind(this);
  }

  handleClick() {
    // ...
  }
}
```

:::info

å¦‚æœä½¿ç”¨äº† `constructor` æ„é€ å‡½æ•°ï¼Œæ¯”å¦‚é…åˆ `super(props)` è°ƒç”¨ `Component` åŸºç±»çš„æ„é€ å‡½æ•°ã€‚

:::

å¦‚æœä½¿ç”¨äº†è¾ƒæ–°çš„ JavaScript è¯­æ³•çš„è¯ï¼Œé‚£ä¹ˆå¾ˆå°‘éœ€è¦ä½¿ç”¨åˆ° constructorsã€‚ç›¸åï¼Œå¯ä»¥ä½¿ç”¨ç°ä»£æµè§ˆå™¨å’Œåƒ Babel è¿™æ ·çš„å·¥å…·éƒ½æ”¯æŒçš„
[å…¬æœ‰ç±»å­—æ®µè¯­æ³•](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Classes/Public_class_fields)
æ¥é‡å†™ä¸Šé¢çš„ä»£ç ï¼š

```jsx {2}
class Counter extends Component {
  state = { counter: 0 };

  handleClick = () => {
    // ...
  };
}
```

## äº‹ä»¶å¤„ç†å‡½æ•°

äº‹ä»¶å¤„ç†å‡½æ•°ä¸ºè‡ªå®šä¹‰å‡½æ•°ï¼Œå®ƒå°†åœ¨å“åº”äº¤äº’ï¼ˆå¦‚ç‚¹å‡»ã€æ‚¬åœã€è¡¨å•è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹ç­‰ï¼‰æ—¶è§¦å‘ã€‚

```jsx
import { Component } from 'react';

class MyButton extends Component {
  handleClick = () => {
    console.log('hello, world!');
  };
  render() {
    return <button onClick={this.handleClick}></button>;
  }
}
```

:::info äº‹ä»¶å¤„ç†å‡½æ•°æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

- é€šå¸¸ç»„ä»¶çš„ å†…éƒ¨ å®šä¹‰
- **åç§°ä»¥ handle å¼€å¤´ï¼Œåè·Ÿäº‹ä»¶åç§°**

:::

### å‘½åäº‹ä»¶å¤„ç†å‡½æ•° prop

å†…ç½®ç»„ä»¶ï¼ˆå¦‚ `<button>` å’Œ `<div>`ï¼‰ä»…æ”¯æŒ
[æµè§ˆå™¨äº‹ä»¶åç§°](https://zh-hans.react.dev/reference/react-dom/components/common#common-props)ï¼Œä¾‹å¦‚
`onClick`ã€‚ä½†æ˜¯ï¼Œè‡ªå®šä¹‰ç»„ä»¶å¯ä»¥æŒ‰ç…§ä¸ªäººå–œå¥½å‘½åäº‹ä»¶å¤„ç†å‡½æ•°çš„ propã€‚

<Tabs>
  <Tab label="çˆ¶ç»„ä»¶">

```jsx {2,9}
import { Component } from 'react';
import MyButton from './MyButton.jsx';

class Profile extends Component {
  handleSmash = () => {
    alert('æ­£åœ¨æ’­æ”¾ï¼');
  };
  render() {
    return <MyButton onSmash={this.handleSmash}>æ’­æ”¾ç”µå½±</MyButton>;
  }
}
```

  </Tab>
  <Tab label="å­ç»„ä»¶">

```jsx {5}
import { Component } from 'react';

class MyButton extends Component {
  render() {
    return <button onClick={this.props.onSmash}>{this.props.children}</button>;
  }
}
```

  </Tab>
</Tabs>

:::info

**æŒ‰ç…§æƒ¯ä¾‹ï¼Œäº‹ä»¶å¤„ç†å‡½æ•° props åº”è¯¥ä»¥ on å¼€å¤´ï¼Œåè·Ÿä¸€ä¸ªå¤§å†™å­—æ¯ã€‚**

:::

### this æŒ‡å‘é—®é¢˜

äº‹ä»¶å¤„ç†å‡½æ•°è¦æ³¨æ„ this æŒ‡å‘é—®é¢˜ï¼Œæ¨èçš„åšæ³•æ˜¯é‡‡ç”¨**ç®­å¤´å‡½æ•°å£°æ˜ç±»å®ä¾‹æ–¹æ³•**ï¼š

```jsx {4}
import { Component } from 'react';

class MyButton extends Component {
  handleClick = () => {
    console.log(this);
  };
  render() {
    return <button onClick={this.handleClick}></button>;
  }
}
```

ä¹Ÿå¯ä»¥é€šè¿‡ `bind` å‡½æ•°æ”¹å˜ this æŒ‡å‘ï¼š

```jsx {8}
import { Component } from 'react';

class MyButton extends Component {
  handleClick() {
    console.log(this);
  }
  render() {
    return <button onClick={this.handleClick.bind(this)}></button>;
  }
}
```

è¿˜å¯ä»¥åœ¨äº‹ä»¶ç»‘å®šçš„æ—¶å€™ï¼Œé¢å¤–ç”¨ç®­å¤´å‡½æ•°åŒ…è£¹ä¸€å±‚æä¾›ä¸€ä¸ªæ–°å‡½æ•°ï¼š

```jsx {8}
import { Component } from 'react';

class MyButton extends Component {
  handleClick() {
    console.log(this);
  }
  render() {
    return <button onClick={() => this.handleClick()}></button>;
  }
}
```

### é˜»æ­¢äº‹ä»¶ä¼ æ’­

äº‹ä»¶å¤„ç†å‡½æ•°æ¥æ”¶ä¸€ä¸ª **äº‹ä»¶å¯¹è±¡** ä½œä¸ºå”¯ä¸€çš„å‚æ•°ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œå®ƒé€šå¸¸è¢«ç§°ä¸º `e`
ï¼Œä»£è¡¨ â€œeventâ€ï¼ˆäº‹ä»¶ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡æ¥è¯»å–æœ‰å…³äº‹ä»¶çš„ä¿¡æ¯ã€‚

```jsx {4-6}
import { Component } from 'react';

export default class MyButton extends Component {
  handleClick = (e) => {
    console.log(e);
  };
  render() {
    return <button onClick={this.handleClick}>ç‚¹å‡»æˆ‘</button>;
  }
}
```

è¿™ä¸ªäº‹ä»¶å¯¹è±¡è¿˜å…è®¸ä½ é˜»æ­¢ä¼ æ’­ã€‚å¦‚æœä½ æƒ³é˜»æ­¢ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾çˆ¶ç»„ä»¶ï¼Œå¯ä»¥è°ƒç”¨ `e.stopPropagation()`ï¼š

```jsx {6}
import { Component } from 'react';

export default class MyButton extends Component {
  handleClickButton = (e) => {
    console.log('button click');
    e.stopPropagation();
  };
  handleClickDiv = (e) => {
    console.log('div click');
  };
  render() {
    return (
      <div onClick={this.handleClickDiv}>
        <h1>stopPropagation é˜»æ­¢äº‹ä»¶ä¼ æ’­</h1>
        <button onClick={this.handleClickButton}>ç‚¹å‡»æˆ‘</button>
      </div>
    );
  }
}
```

### é˜»æ­¢é»˜è®¤è¡Œä¸º

æŸäº›æµè§ˆå™¨äº‹ä»¶å…·æœ‰ä¸äº‹ä»¶ç›¸å…³è”çš„é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œç‚¹å‡» `<form>`
è¡¨å•å†…éƒ¨çš„æŒ‰é’®ä¼šè§¦å‘è¡¨å•æäº¤äº‹ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ã€‚å¯ä»¥è°ƒç”¨äº‹ä»¶å¯¹è±¡ä¸­çš„ `e.preventDefault()`
æ¥é˜»æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼š

```jsx {8}
import { Component } from 'react';

export default class MyButton extends Component {
  render() {
    return (
      <form
        onSubmit={(e) => {
          e.preventDefault();
          alert('æäº¤è¡¨å•ï¼');
        }}
      >
        <input />
        <button>å‘é€</button>
      </form>
    );
  }
}
```

## ç”Ÿå‘½å‘¨æœŸ

ç±»ç»„ä»¶å¯ä»¥å£°æ˜ä¸€äº›ç‰¹æ®Šçš„æ–¹æ³•ï¼Œåœ¨ç»„ä»¶æŒ‚è½½ã€æ›´æ–°ã€å¸è½½è¿‡ç¨‹ä¸­ä¼šå»è¿è¡Œè¿™ç±»è¢«ç§°ä¸º[ç”Ÿå‘½å‘¨æœŸ](https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/)çš„é’©å­ã€‚

![å¸¸ç”¨ç”Ÿå‘½å‘¨æœŸå›¾è°±](/react-ecology/react/006-react-lifecycle.png)

### componentDidMount

[`componentDidMount`](https://zh-hans.react.dev/reference/react/Component#componentdidmount) æ–¹æ³•ä¼šåœ¨ç»„ä»¶è¢« **ç»˜åˆ¶**
åˆ°å±å¹•ï¼ˆæŒ‚è½½ï¼‰åè°ƒç”¨ã€‚è¿™é‡Œæ˜¯è®¾ç½®æ•°æ®è·å–ã€è®¢é˜…ç›‘å¬äº‹ä»¶æˆ–æ“ä½œ DOM èŠ‚ç‚¹çš„å¸¸è§ä½ç½®ã€‚

```jsx {6-9}
class ChatRoom extends Component {
  state = {
    serverUrl: 'https://localhost:1234',
  };

  componentDidMount() {
    this.setupConnection();
  }

  componentDidUpdate(prevProps, prevState) {
    if (this.props.roomId !== prevProps.roomId || this.state.serverUrl !== prevState.serverUrl) {
      this.destroyConnection();
      this.setupConnection();
    }
  }

  componentWillUnmount() {
    this.destroyConnection();
  }
}
```

:::note

åœ¨å®šä¹‰ `componentDidMount` ä¹‹åï¼Œé€šå¸¸éœ€è¦è®¾ç½®ä¸€äº›å…¶ä»–çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ¥é¿å…å‡ºé”™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `componentDidMount`
è¯»å–ä¸€äº› state æˆ–è€… propsï¼Œè¿˜å¿…é¡»è¦è®¾ç½® `componentDidUpdate` æ¥å¤„ç†å®ƒä»¬çš„æ›´æ–°ï¼Œä»¥åŠè®¾ç½® `componentWillUnmount` æ¥æ¸…ç†
`componentDidMount` çš„æ•ˆæœã€‚

:::

### componentDidUpdate

[`componentDidUpdate`](https://zh-hans.react.dev/reference/react/Component#componentdidupdate)
æ–¹æ³•ä¼šåœ¨ç»„ä»¶æ›´æ–°äº† props æˆ– state **é‡æ–°ç»˜åˆ¶** åè°ƒç”¨ï¼Œä½†ä¸ä¼šåœ¨é¦–æ¬¡ç»˜åˆ¶æ—¶è°ƒç”¨ã€‚

```jsx {9-15}
class ChatRoom extends Component {
  state = {
    serverUrl: 'https://localhost:1234',
  };

  componentDidMount() {
    this.setupConnection();
  }

  componentDidUpdate(prevProps, prevState) {
    if (this.props.roomId !== prevProps.roomId || this.state.serverUrl !== prevState.serverUrl) {
      this.destroyConnection();
      this.setupConnection();
    }
  }

  componentWillUnmount() {
    this.destroyConnection();
  }
}
```

:::note

ä½ å¯ä»¥åœ¨ä¸€æ¬¡æ›´æ–°åä½¿ç”¨å®ƒæ¥æ“ä½œ DOMï¼Œå¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ä¹Ÿå¯èƒ½ä¼šä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚åªè¦å°†å½“å‰çš„ props ä¸ä»¥å‰çš„ props è¿›è¡Œæ¯”è¾ƒï¼ˆå› ä¸ºï¼Œå¦‚æœ props æ²¡æœ‰æ›´æ”¹ï¼Œåˆ™å¯èƒ½ä¸éœ€è¦ç½‘ç»œè¯·æ±‚ï¼‰ã€‚è¿™ä¸ªæ–¹æ³•ä¸€èˆ¬ä¼šå’Œ
`componentDidMount` ä»¥åŠ `componentWillUnmount` ä¸€èµ·ä½¿ç”¨ï¼š

:::

### componentWillUnmont

`componentWillUnmount` æ–¹æ³•ä¼šåœ¨ç»„ä»¶è¢« **ç§»é™¤å±å¹•ï¼ˆå¸è½½ï¼‰ä¹‹å‰** è°ƒç”¨å®ƒï¼Œé€šå¸¸ç”¨äºå–æ¶ˆæ•°æ®è·å–æˆ–ç§»é™¤ç›‘å¬äº‹ä»¶ã€‚

```jsx {17-19}
class ChatRoom extends Component {
  state = {
    serverUrl: 'https://localhost:1234',
  };

  componentDidMount() {
    this.setupConnection();
  }

  componentDidUpdate(prevProps, prevState) {
    if (this.props.roomId !== prevProps.roomId || this.state.serverUrl !== prevState.serverUrl) {
      this.destroyConnection();
      this.setupConnection();
    }
  }

  componentWillUnmount() {
    this.destroyConnection();
  }
}
```

:::note

`componentWillUnmount` å†…éƒ¨çš„é€»è¾‘åº”è¯¥å®Œå…¨â€œå¯¹åº”â€åˆ° `componentDidMount` å†…éƒ¨çš„é€»è¾‘ã€‚ä¾‹å¦‚ï¼š

- å¦‚æœ `componentDidMount` è®¾ç½®äº†ä¸€ä¸ªç›‘å¬äº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨ `componentWillUnmount` ä¸­å°±åº”è¯¥æ¸…é™¤æ‰è¿™ä¸ªç›‘å¬äº‹ä»¶
- å¦‚æœ `componentWillUnmount` çš„æ¸…ç†é€»è¾‘ä¸­è¯»å–äº†ä¸€äº› props æˆ–è€… stateï¼Œé‚£ä¹ˆé€šå¸¸è¿˜éœ€è¦å®ç°ä¸€ä¸ª `componentDidUpdate`
  æ¥æ¸…ç†ä½¿ç”¨äº†æ—§ props å’Œ state çš„èµ„æºï¼ˆä¾‹å¦‚ç›‘å¬äº‹ä»¶ï¼‰

:::

### shouldComponentUpdate

:::warning æ³¨æ„

é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦è°ƒç”¨äº† `setState` å°±ä¼šè§¦å‘ renderï¼ˆå³ä½¿ state æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼‰ï¼Œè¿™æ ·ä¸å¯é¿å…ä¼šé€ æˆä¸€äº›æ€§èƒ½é—®é¢˜ã€‚

:::

[`shouldComponentUpdate`](https://zh-hans.react.dev/reference/react/Component#shouldcomponentupdate)
å¯ä»¥ç”¨æ¥ç¡®å®šæ˜¯å¦éœ€è¦ **è·³è¿‡é‡æ–°æ¸²æŸ“**ã€‚å½“æ”¶åˆ°æ–°çš„ props æˆ– state æ—¶ï¼ŒReact ä¼šåœ¨æ¸²æŸ“ä¹‹å‰è°ƒç”¨
`shouldComponentUpdate`ï¼Œé»˜è®¤è¿”å›å€¼å€¼ä¸º trueï¼Œè¡¨ç¤ºéœ€è¦é‡æ–°æ¸²æŸ“ã€‚åˆå§‹æ¸²æŸ“æˆ–ä½¿ç”¨ `forceUpdate` æ—¶å°†ä¸ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚

```jsx {6-18}
class Rectangle extends Component {
  state = {
    isHovered: false,
  };

  shouldComponentUpdate(nextProps, nextState) {
    if (
      nextProps.position.x === this.props.position.x &&
      nextProps.position.y === this.props.position.y &&
      nextProps.size.width === this.props.size.width &&
      nextProps.size.height === this.props.size.height &&
      nextState.isHovered === this.state.isHovered
    ) {
      // æ²¡æœ‰ä»»ä½•æ”¹å˜ï¼Œå› æ­¤ä¸éœ€è¦é‡æ–°æ¸²æŸ“
      return false;
    }
    return true;
  }
}
```

#### pureComponent

ä½¿ç”¨ `shouldComponentUpdate` æ‰‹åŠ¨åˆ¤æ–­æ˜¯å¦è¦é‡æ–°è§¦å‘æ¸²æŸ“è¿˜æ˜¯å¾ˆç¹çï¼ŒReact æä¾›äº†
[`pureComponent`](https://zh-hans.react.dev/reference/react/PureComponent)
ç»„ä»¶è‡ªåŠ¨å¤„ç†è¿™äº›äº‹æƒ…ï¼Œ_å½“ props å’Œ state ä¸ä¹‹å‰ä¿æŒä¸€è‡´æ—¶ä¼šè·³è¿‡é‡æ–°æ¸²æŸ“_ã€‚

```jsx
class Greeting extends PureComponent {
  render() {
    return <h1>Hello, {this.props.name}!</h1>;
  }
}
```

### getSnapshotBeforeUpdate

[`getSnapshotBeforeUpdate`](https://zh-hans.react.dev/reference/react/Component#getsnapshotbeforeupdate)
ä¼šåœ¨**æ›´æ–° DOM ä¹‹å‰**è¢«è°ƒç”¨ã€‚å®ƒèƒ½å¤Ÿåœ¨ DOM å‘ç”Ÿæ›´æ”¹ä¹‹å‰æ•è·ä¸€äº›ä¿¡æ¯ï¼ˆä¾‹å¦‚æ»šåŠ¨çš„ä½ç½®ï¼‰ï¼Œæ­¤ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¿”å›çš„ä»»ä½•å€¼éƒ½å°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™
`componentDidUpdate`ã€‚

ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨åƒæ˜¯éœ€è¦åœ¨æ›´æ–°æœŸé—´ä¿ç•™å…¶æ»šåŠ¨ä½ç½®çš„èŠå¤©æ¶ˆæ¯çš„ UI ä¸­æ¥ä½¿ç”¨å®ƒï¼š

```jsx {7-15,17}
class ScrollingList extends React.Component {
  constructor(props) {
    super(props);
    this.listRef = React.createRef();
  }

  getSnapshotBeforeUpdate(prevProps, prevState) {
    // æˆ‘ä»¬æ˜¯å¦è¦å‘åˆ—è¡¨ä¸­æ·»åŠ æ–°å†…å®¹ï¼Ÿ
    // æ•è·æ»šåŠ¨çš„â€‹â€‹ä½ç½®ï¼Œä»¥ä¾¿æˆ‘ä»¬ç¨åå¯ä»¥è°ƒæ•´æ»šåŠ¨ã€‚
    if (prevProps.list.length < this.props.list.length) {
      const list = this.listRef.current;
      return list.scrollHeight - list.scrollTop;
    }
    return null;
  }

  componentDidUpdate(prevProps, prevState, snapshot) {
    // å¦‚æœæˆ‘ä»¬æœ‰å¿«ç…§å€¼ï¼Œé‚£ä¹ˆè¯´æ˜æˆ‘ä»¬åˆšåˆšæ·»åŠ äº†æ–°å†…å®¹ã€‚
    // è°ƒæ•´æ»šåŠ¨ï¼Œä½¿å¾—è¿™äº›æ–°å†…å®¹ä¸ä¼šå°†æ—§å†…å®¹æ¨å‡ºè§†é‡ã€‚
    //ï¼ˆè¿™é‡Œçš„ snapshot æ˜¯ getSnapshotBeforeUpdate è¿”å›çš„å€¼ï¼‰
    if (snapshot !== null) {
      const list = this.listRef.current;
      list.scrollTop = list.scrollHeight - snapshot;
    }
  }

  render() {
    return <div ref={this.listRef}>{/* ...contents... */}</div>;
  }
}
```

:::warning

ç›®å‰ï¼Œå‡½æ•°å¼ç»„ä»¶ä¸­è¿˜æ²¡æœ‰ä¸ `getSnapshotBeforeUpdate`
ç­‰åŒçš„æ–¹æ³•ã€‚è¿™ç§ä½¿ç”¨åœºæ™¯éå¸¸ç½•è§ï¼Œå¦‚æœæœ‰è¿™ç§éœ€æ±‚ï¼Œé‚£ä¹ˆå¿…é¡»ç¼–å†™ä¸€ä¸ªç±»å¼ç»„ä»¶ã€‚

:::

## æ“ä½œ DOM

ç±»ç»„ä»¶æ“ä½œ DOM æœ‰ä¸¤ç§æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨ `React.createRef` å£°æ˜ä¸€ä¸ª Refï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å›è°ƒå‡½æ•°è·å– DOMã€‚

### createRef

[`createRef`](https://zh-hans.react.dev/reference/react/createRef)
å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ª ref å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥åŒ…å«ä»»æ„å€¼ï¼Œå¹¶ä¸”å®ƒåªæœ‰ä¸€ä¸ªå±æ€§ `current`ï¼š

```jsx {4,7,13}
import { Component, createRef } from 'react';

export default class Form extends Component {
  inputRef = createRef();

  handleClick = () => {
    this.inputRef.current.focus();
  };

  render() {
    return (
      <>
        <input ref={this.inputRef} />
        <button onClick={this.handleClick}>èšç„¦è¿™ä¸ªè¾“å…¥æ¡†</button>
      </>
    );
  }
}
```

:::info æ³¨æ„

- åœ¨ç±»ç»„ä»¶ä¸­ï¼Œ`createRef` æ€»æ˜¯è¿”å›ä¸€ä¸ª**ä¸åŒçš„**å¯¹è±¡ï¼Œç›¸å½“äºè‡ªå·±ç¼–å†™äº† `{ current: null }`
- åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œ`useRef` å§‹ç»ˆè¿”å›ç›¸åŒçš„å¯¹è±¡

:::

### callbackRef

ä¹Ÿå¯ä»¥ç›´æ¥æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ç»™ ref å±æ€§ï¼Œåœ¨å›è°ƒå‡½æ•°çš„å‚æ•°ä¸­ä¹Ÿå¯ä»¥è·å–åˆ° DOMï¼š

```jsx {4,7,10-12,17}
import { Component } from 'react';

export default class Form extends Component {
  inputRef = null;

  handleClick = () => {
    this.inputRef.focus();
  };

  callbackRef = (refTarget) => {
    this.inputRef = refTarget;
  };

  render() {
    return (
      <>
        <input ref={this.callbackRef} />
        <button onClick={this.handleClick}>èšç„¦è¿™ä¸ªè¾“å…¥æ¡†</button>
      </>
    );
  }
}
```

## è·¨å±‚çº§é€šè®¯ Context

é€šå¸¸æ¥è¯´ï¼Œprops å¯ä»¥å°†ä¿¡æ¯ä»çˆ¶ç»„ä»¶ä¼ é€’åˆ°å­ç»„ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦é€šè¿‡è®¸å¤šä¸­é—´ç»„ä»¶å‘ä¸‹ä¼ é€’ propsï¼Œæˆ–æ˜¯åº”ç”¨ä¸­çš„è®¸å¤šç»„ä»¶éœ€è¦ç›¸åŒçš„ä¿¡æ¯ï¼Œä¼ é€’ props ä¼šå˜çš„ååˆ†å†—é•¿å’Œä¸ä¾¿ã€‚

Context å…è®¸çˆ¶ç»„ä»¶å‘å…¶ä¸‹å±‚æ— è®ºå¤šæ·±çš„ä»»ä½•ç»„ä»¶æä¾›ä¿¡æ¯ï¼Œè€Œæ— éœ€é€šè¿‡ props æ˜¾å¼ä¼ é€’ã€‚

:::note ä½¿ç”¨æ­¥éª¤

1. ä½¿ç”¨ [`createContext`](https://zh-hans.react.dev/reference/react/createContext) åˆ›å»ºç»„ä»¶ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰

```jsx
import { createContext } from 'react';

const ThemeContext = createContext('light');

export default ThemeContext;
```

2. ç”¨ä¸Šä¸‹æ–‡ [Provider](https://zh-hans.react.dev/reference/react/createContext#provider)
   ç»„ä»¶åŒ…è£¹ç¥–å…ˆå®¹å™¨ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªä¸Šä¸‹æ–‡çš„å€¼

```jsx
import ThemeContext from './ThemeContext.js'

function App() {
  const [theme, setTheme] = useState('light');
  // â€¦â€¦
  return (
    <ThemeContext.Provider value={theme}>
      <Page />
    </ThemeContext.Provider>
  );
```

3. ç”¨ä¸Šä¸‹æ–‡ [Consumer](https://zh-hans.react.dev/reference/react/createContext#consumer)
   ç»„ä»¶æ¶ˆè´¹ä¸Šä¸‹æ–‡çš„å€¼ï¼ŒConsumer ç»„ä»¶å†…æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°

```jsx
function Button() {
  // ğŸŸ¡ é—ç•™æ–¹å¼ (ä¸æ¨è)
  return <ThemeContext.Consumer>{(theme) => <button className={theme} />}</ThemeContext.Consumer>;
}
```

:::

å¯ä»¥åŒæ—¶åˆ›å»ºå’Œä½¿ç”¨å¤šä¸ªä¸Šä¸‹æ–‡ã€‚

## é”™è¯¯è¾¹ç•Œ

:::note

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­æŠ›å‡ºé”™è¯¯ï¼ŒReact å°†ä¼šä»å±å¹•ä¸Šåˆ é™¤å…¶ UIã€‚

ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œå¯ä»¥å°† UI çš„ä¸€éƒ¨åˆ†åŒ…è£…åˆ° **é”™è¯¯è¾¹ç•Œ**
ä¸­ã€‚é”™è¯¯è¾¹ç•Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»„ä»¶ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºä¸€äº›åå¤‡ UIï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºä¾‹å¦‚é”™è¯¯æ¶ˆæ¯è¿™æ ·å´©æºƒçš„éƒ¨åˆ†ã€‚

:::

è¦å®ç°é”™è¯¯è¾¹ç•Œç»„ä»¶ï¼Œéœ€è¦æä¾›
[`static getDerivedStateFromError`](https://zh-hans.react.dev/reference/react/Component#static-getderivedstatefromerror)
æ–¹æ³•ï¼Œåœ¨å­ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­æŠ›å‡ºé”™è¯¯æ—¶å®ƒä¼šè¢«è°ƒç”¨ã€‚è¿˜å¯ä»¥é€‰æ‹©å®ç°
[`componentDidCatch`](https://zh-hans.react.dev/reference/react/Component#componentdidcatch)
æ¥æ·»åŠ ä¸€äº›é¢å¤–çš„é€»è¾‘ï¼Œä¾‹å¦‚å°†é”™è¯¯æ·»åŠ åˆ°åˆ†ææœåŠ¡ã€‚

```jsx {9-12}
import * as React from 'react';

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    // æ›´æ–°çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡æ¸²æŸ“å°†æ˜¾ç¤ºåå¤‡ UIã€‚
    return { hasError: true };
  }

  componentDidCatch(error, info) {
    logErrorToMyService(
      error,
      // ç¤ºä¾‹â€œç»„ä»¶å †æ ˆâ€ï¼š
      // åœ¨ ComponentThatThrows ä¸­ï¼ˆç”± App åˆ›å»ºï¼‰
      // åœ¨ ErrorBoundary ä¸­ï¼ˆç”± APP åˆ›å»ºï¼‰
      // åœ¨ div ä¸­ï¼ˆç”± APP åˆ›å»ºï¼‰
      // åœ¨ App ä¸­
      info.componentStack,
      // ä»…åœ¨ react@canary ç‰ˆæœ¬å¯ç”¨
      // è­¦å‘Šï¼šOwner Stack åœ¨ç”Ÿäº§ä¸­ä¸å¯ç”¨
      React.captureOwnerStack(),
    );
  }

  render() {
    if (this.state.hasError) {
      // ä½ å¯ä»¥æ¸²æŸ“ä»»ä½•è‡ªå®šä¹‰åå¤‡ UI
      return this.props.fallback;
    }

    return this.props.children;
  }
}
```

ç„¶åå¯ä»¥ç”¨å®ƒåŒ…è£…ç»„ä»¶æ ‘çš„ä¸€éƒ¨åˆ†ï¼š

```jsx {1,3}
<ErrorBoundary fallback={<p>Something went wrong</p>}>
  <Profile />
</ErrorBoundary>
```

å¦‚æœ Profile æˆ–å…¶å­ç»„ä»¶æŠ›å‡ºé”™è¯¯ï¼ŒErrorBoundary å°†â€œæ•è·â€è¯¥é”™è¯¯ï¼Œç„¶åæ˜¾ç¤ºå¸¦æœ‰ä½ æä¾›çš„é”™è¯¯æ¶ˆæ¯çš„åå¤‡ UIï¼Œå¹¶å‘ä½ çš„é”™è¯¯æŠ¥å‘ŠæœåŠ¡å‘é€ç”Ÿäº§é”™è¯¯æŠ¥å‘Šã€‚

:::note

ä¸éœ€è¦å°†æ¯ä¸ªç»„ä»¶åŒ…è£…åˆ°å•ç‹¬çš„é”™è¯¯è¾¹ç•Œä¸­ã€‚åœ¨è€ƒè™‘ é”™è¯¯è¾¹ç•Œçš„å¸ƒç½® æ—¶ï¼Œéœ€è¦è€ƒè™‘åœ¨å“ªé‡Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯æ‰æœ‰æ„ä¹‰ã€‚

ä¾‹å¦‚ï¼Œåœ¨æ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä¸­ï¼Œåœ¨å¯¹è¯åˆ—è¡¨å‘¨å›´æ”¾ç½®é”™è¯¯è¾¹ç•Œæ˜¯æœ‰æ„ä¹‰çš„ã€‚åœ¨æ¯æ¡å•ç‹¬çš„æ¶ˆæ¯å‘¨å›´æ”¾ç½®ä¸€ä¸ªä¹Ÿæ˜¯æœ‰æ„ä¹‰çš„ã€‚ç„¶è€Œï¼Œåœ¨æ¯ä¸ªå¤´åƒå‘¨å›´è®¾ç½®è¾¹ç•Œæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚

:::

## ç»„ä»¶å¤ç”¨æ¨¡å¼

ç±»ç»„ä»¶çš„ç»„ä»¶å¤ç”¨æ¨¡å¼ä¸»è¦æœ‰ä¸¤ç§ï¼šRender Props æ¨¡å¼ å’Œ é«˜é˜¶ç»„ä»¶(HOC)æ¨¡å¼ã€‚

### Render Props

ç®€å•æ¥è¯´å°±æ˜¯ï¼Œå­ç»„ä»¶æ§åˆ¶é€»è¾‘ï¼Œä¸åŒ…å«å…·ä½“ UI å®ç°ï¼Œçˆ¶ç»„ä»¶é€šè¿‡ prop å°†å®é™…æ¸²æŸ“ UI ä¼ å…¥è¿›å»ï¼Œè¾¾åˆ°å…±äº«é€»è¾‘çš„æ•ˆæœã€‚

<Tabs>
  <Tab label="çˆ¶ç»„ä»¶">

```jsx {2,8-12}
import { Component } from 'react';
import MouseTracker from './MouseTracker.jsx';

class Profile extends Component {
  render() {
    return (
      <MouseTracker
        render={({ x, y }) => (
          <h1>
            é¼ æ ‡ä½ç½®: ({x}, {y})
          </h1>
        )}
      />
    );
  }
}
```

  </Tab>
  <Tab label="å­ç»„ä»¶">

```jsx {17}
import { Component } from 'react';

export default class MouseTracker extends Component {
  state = {
    x: 0,
    y: 0,
  };

  handleMouseMove = (event) => {
    this.setState({
      x: event.clientX,
      y: event.clientY,
    });
  };

  render() {
    return <div onMouseMove={this.handleMouseMove}>{this.props.render(this.state)}</div>;
  }
}
```

  </Tab>
</Tabs>

### é«˜é˜¶ç»„ä»¶ (HOC)

é«˜é˜¶ç»„ä»¶æ˜¯ä¸€ä¸ª æ¥æ”¶ä¸€ä¸ªç»„ä»¶ å¹¶ è¿”å›ä¸€ä¸ªæ–°ç»„ä»¶ çš„å‡½æ•°ï¼Œå‚æ•°ç»„ä»¶æ¥æ”¶ props å®ç°å¤ç”¨ç»„ä»¶é€»è¾‘ã€‚

<Tabs>
  <Tab label="çˆ¶ç»„ä»¶">

```jsx {2,4-8}
import { Component } from 'react';
import withMouse from './MouseTracker.jsx';

const Profile = withMouse(({ mouse }) => (
  <h1>
    é¼ æ ‡ä½ç½®: ({mouse.x}, {mouse.y})
  </h1>
));
```

  </Tab>
  <Tab label="å­ç»„ä»¶">

```jsx {3-4,17}
import { Component } from 'react';

export default function withMouse(CustomComponent) {
  return class extends Component {
    state = { x: 0, y: 0 };

    handleMouseMove = (event) => {
      this.setState({
        x: event.clientX,
        y: event.clientY,
      });
    };

    render() {
      return (
        <div onMouseMove={this.handleMouseMove}>
          <CustomComponent {...this.props} mouse={this.state} />
        </div>
      );
    }
  };
}
```

  </Tab>
</Tabs>
